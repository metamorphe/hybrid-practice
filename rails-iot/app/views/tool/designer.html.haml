%head
  :javascript
    var zb, cp, bb, vm, sm, fm, displays = [];
     
    $(function(){
      paperSetup();
      fm = new FileManger(files);
      cp = new ColorPalette($('#sidebar-left'));
      bb = new BrushBar($('#brush-bar')); 
      vm = new ViewManager($('#views'));
      $('img[tool="LEDPlacerBrush"]').click();
      // var display = new Artwork("/userstudy/example_sun_moon.svg", function(artwork){
      // var display = new Artwork("/artwork/gecko.svg", function(artwork){
      var display = new Artwork("/userstudy/example_hairpiece_camera_ready.svg", function(artwork){
         CanvasUtil.call(CanvasUtil.queryPrefix("NP"), "remove");
        
         // artwork.svg.position = paper.view.center;
         // artwork.svg.position.y -= 40;
      
         
         
         $('#cache-reload').click();
      });
      displays.push(display);
      sm = new SelectionManager();
      zb = new ZoomBar($("#zoom-bar"), 1.0, paper);
      cc = new ControlCenter($('#sidebar-left-control'));
     

      $("#shade").fadeOut("slow");

      var confirmOnPageExit = function (e) 
      {
        $('#cache-save').click();
        // return "Make sure you save!";
      };
      window.onbeforeunload = confirmOnPageExit;
    });

    function paperSetup(){

      $('#myCanvas').attr('height', $(window).height() - 50);
      $('#myCanvas').attr('width', $(window).width());

      paper.install(window);
      paper.setup('myCanvas');
    }
%body
  %nav.navbar.navbar-default
    .container-fluid
      / Brand and toggle get grouped for better mobile display
      .navbar-header
        %button.navbar-toggle.collapsed{"aria-expanded" => "false", "data-target" => "#bs-example-navbar-collapse-1", "data-toggle" => "collapse", :type => "button"}
          %span.sr-only Toggle navigation
          %span.icon-bar
          %span.icon-bar
          %span.icon-bar
        %a.navbar-brand{:href => "/"}
          %b#logo ELD
      / Collect the nav links, forms, and other content for toggling
      #bs-example-navbar-collapse-1.collapse.navbar-collapse
        %ul.nav.navbar-nav
          %li.dropdown
            %a.dropdown-toggle{"aria-expanded" => "false", "aria-haspopup" => "true", "data-toggle" => "dropdown", :href => "#", :role => "button"}
              File
              %span.caret
            %ul.dropdown-menu
              %li
                %a{"data-target" => "#new", "data-toggle" => "modal", :href => "#"} New
              %li.divider{:role => "separator"}
              %li
                %a{"data-target" => "#open", "data-toggle" => "modal", :href => "#"} Open..
              %li
                %a{"data-target" => "#insert", "data-toggle" => "modal", :href => "#"} Insert Display...
              %li
                %a{"data-target" => "#upload", "data-toggle" => "modal", :href => "#"} Upload SVG
              %li.divider{:role => "separator"}
              %li
                %a{"data-target" => "#export", "data-toggle" => "modal", :href => "#"} Export...
              %li.divider{:role => "separator"}
              %li
                %a{"data-target" => "#about", "data-toggle" => "modal", :href => "#"} About ELD
          %li
            %a#cache-save.pull-left.navbar-link.btn.btn-xs.btn-transparent
              %span.glyphicon.glyphicon-floppy-disk
              SAVE
            %a#cache-reload.pull-left.navbar-link.btn.btn-xs.btn-transparent
              %span.glyphicon.glyphicon-refresh
              RELOAD
            %a#cache-clear.pull-left.navbar-link.btn.btn-xs.btn-transparent
              %span.glyphicon.glyphicon-ban-circle
              CLEAR LEDS
        / USER DROPDOWN
        %ul.nav.navbar-nav.navbar-right
          - if user_signed_in?
            %li.dropdown
              %a.dropdown-toggle{"aria-expanded" => "false", "aria-haspopup" => "true", "data-toggle" => "dropdown", :href => "#", :role => "button"}
                %span.badgify.glyphicon.glyphicon-user
                %strong= current_user.email
                %span.caret
              %ul.dropdown-menu{:role => "menu"}
                %li
                  = link_to "Upload a model".html_safe, "", :class => 'navbar-link'
                %li.divider
                %li
                  = link_to "Your collection".html_safe, :class => 'navbar-link'
                %li
                  = link_to 'Edit profile', edit_user_registration_path, :class => 'navbar-link'
                %li.divider
                %li= link_to 'Sign out', destroy_user_session_path, :method => :delete, :class => 'navbar-link'
          - else
            %li
              - link_to "Sign up", new_user_registration_path, :class => 'navbar-link'
            %li= link_to "Login", new_user_session_path, :class => 'navbar-link'
      / /.navbar-collapse
    / /.container-fluid
  %canvas#myCanvas
  #sidebar-right.col-xs-4
    %h3 MODE
    .btn-group
      %button#live.mode.btn.btn-default
        LIVE
  = render :partial => "modals"
  = render :partial => "views"
  = render :partial => "color_palette"
  = render :partial => "control"
  = render :partial => "brush_bar"
  = render :partial => "zoom_bar"
:css
  body, html{
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: #f5f4f0;
  }
  .input-group {
    padding-bottom: 10px;
  }
  .badgify{
    background: white;
    border: solid 1px #999;
    border-radius: 10px;
    padding: 4px;
  }
  #myCanvas {
    position: absolute;
    top: 60px;
    /*display: none;*/
    z-index: -100;
    cursor: pointer;
  }
  #sidebar-right{
    display: none;
    background: red;
    position: absolute;
    top: 0;
    right: 0;
    width: 200px;
    height: 100%;

  }

  .btn-transparent{
    background: none;
    border: none;
  }

  .btn-transparent:visited{
    color: #f5f4f0;
    outline: none;
  }
  .btn-transparent:hover{
    color: #f5f4f0;
    outline: none;
  }
  .btn-transparent:active{
    color: #f5f4f0;
    outline: none;
  }

  .btn-transparent:focus{
    color: #f5f4f0;
    outline: none;
  }

  .clearfix{
    clear: both;
  }
