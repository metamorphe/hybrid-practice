   <script type="text/javascript">
      var files = <%= @files.to_json.html_safe %>;
      var ports = <%= @ports.to_json.html_safe %>;
      var papers = [];
      var miniPaper, mainPaper;
      var DEFAULT_PIPE_FILE = "example_sunmoon_4inches.svg";
      var vm, fm, ws;
      var SELECTOR_SELECT = function(path){
        name = Artwork.getPrefix(path);
        if(name == "NLED")
          path.set({strokeWidth: 2, strokeColor: "#00A8E1"});
        else
          path.set({strokeWidth: 2, strokeColor: "#00A8E1", dashArray: [], opacity: 0.5, fillColor: "#00A8E1"})
      }

      $(function(){ 
        Utility.paperSetup('myCanvas');
        ws = new WebStorage();
        fm = new FileManager(files);

        $("#shade").fadeOut("slow");
        


        // TEMPLATE UPDATE
        var widgets = $("#status .widget-title");
        var template = $('#widget-title');

        _.each(widgets, function(widget){
          var t = template.clone();
          var name = $(widget).attr('name');
        
          t.removeClass('template');
          t.find('span#name').html(name);
          $(widget).html(t.children());
        }); 

        // EYE FUNCTIONALITY
        $('.viewer').click(function(){
            $(this).parent().siblings().toggleClass('hide');
            var eye = $(this).find('span'); 
            if(eye.hasClass("glyphicon-eye-open")){ eye.removeClass('glyphicon-eye-open'); eye.addClass('glyphicon-eye-close');}
            else {eye.addClass('glyphicon-eye-open'); eye.removeClass('glyphicon-eye-close');};
           
        })
      });
           sm = new SelectionManager(SELECTOR_SELECT);


      // papers = [];
      // function paperSetup(id){
      //   var dom = $("#" + id);
      //   console.log(dom.parent().height());
      //   dom.attr('height', dom.parent().height());
      //   dom.attr('width', dom.parent().width());
      //   // paper.install(window);
      //   var myPaper = new paper.PaperScope();
      //   myPaper.setup(id);
      //   papers.push(myPaper);
      //   return myPaper;
      // }
      
    </script>
  </head>
  <body>
    
   
 <%= render :partial => "widget_template" %>
    <div id="control-container">
      <div id="view-container">
        <div id="main" class="col-xs-8 nopadding">
          <%= render :partial => "canvas_widget" %>
        </div>
        
        <!-- STATUS BAR -->
        <div id="status" class="col-xs-4">
        
         <%= render :partial => "port_select_widget" %>
         <%= render :partial => "file_select_widget" %>
         <% render :partial => "motion_widget" %>
         <% render :partial => "graph_widget" %>
         <% render :partial => "stream_widget" %>
         <%= render :partial => "quick_behaviors_widget" %>
         <%= render :partial => "selectors_widget" %>
        </div>
        <!-- END STATUS BAR -->

      </div>
      <div id="ui-container">
        <div id="ui" class="">
          <%= render :partial => "interaction_ui"%>
        </div>
      </div>
      </div>
    </div>
      <% render :partial => "modals"%>
      <%= render :partial => "views"%>
      <% render :partial => "color_palette"%>
      <% render :partial => "brush_bar"%>
      <% render :partial => "control"%>
      <% render :partial => "zoom_bar"%>
  </body>

  <style>
    #main, #status, #ui{
      height: 100%;
    }
    .template{
      display: none;
    }
    .hide{
      display: none;
    }
    .form-control-special{
      display: block;
      /* width: 100%; */
      height: 34px;
      padding: 6px 12px;
      font-size: 14px;
      line-height: 1.428571429;
      color: #555555;
      background-color: white;
      background-image: none;
      border: 1px solid #cccccc;
      /*border-radius: 4px;*/
      border-top-left-radius: 4px;
      border-bottom-left-radius: 4px;
      border-bottom-right-radius: 0px;
      border-top-right-radius: 0px;

      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
      box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
      -webkit-transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s;
      -o-transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s;
      transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s;
    }

   
  </style>
